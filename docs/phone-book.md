# مستندات ماژول: دفتر تلفن

## معرفی

ماژول "دفتر تلفن" به کاربران این امکان را می‌دهد که لیست مخاطبین خود را به راحتی مدیریت کنند. قابلیت‌های کلیدی این ماژول شامل افزودن، ویرایش، حذف، جستجو و مهم‌تر از همه، وارد کردن (Import) و خروجی گرفتن (Export) از مخاطبین با فرمت استاندارد **VCF (vCard)** است.

## ساختار فایل‌ها

- **`PhoneBook.tsx`**: کامپوننت اصلی که UI ماژول، شامل لیست مخاطبین گروه‌بندی شده، نوار جستجو و مودال افزودن/مشاهده/ویرایش را نمایش می‌دهد.
- **`store.ts`**: فایل مدیریت وضعیت ماژول با `usePhoneBookStore` که منطق ذخیره‌سازی مخاطبین را در خود جای داده است.
- **`types.ts`**: شامل تعریف اینترفیس `Contact` و `TypedEntry` برای شماره‌های تلفن و ایمیل‌ها.
- **`vcf.ts`**: یک فایل کمکی بسیار مهم که شامل توابع `parseVCF` و `generateVCF` برای کار با فرمت vCard است.

## مدیریت وضعیت (`store.ts`)

این ماژول از `usePhoneBookStore` برای مدیریت مخاطبین استفاده می‌کند.

### State

- **`contacts`**: یک آرایه از آبجکت‌های `Contact` که لیست تمام مخاطبین کاربر را نگهداری می‌کند.

### Actions (توابع)

- **`saveContact(contact)`**: یک مخاطب جدید را اضافه یا یک مخاطب موجود را ویرایش می‌کند.
- **`deleteContact(id)`**: یک مخاطب را با `id` آن حذف می‌کند.
- **`importContacts(newContacts)`**: مخاطبین جدید را از یک فایل VCF دریافت کرده و به لیست فعلی اضافه می‌کند. این تابع هوشمند است و از افزودن مخاطبینی که نام (`fn`) آن‌ها از قبل در لیست وجود دارد، جلوگیری می‌کند تا از ایجاد داده تکراری جلوگیری شود.

این store نیز با استفاده از `persist` middleware داده‌های خود را در `localStorage` و تحت کلید `lifeManagerPhoneBook` ذخیره می‌کند.

## واردات و صادرات VCF (`vcf.ts`)

این بخش یکی از قابلیت‌های کلیدی ماژول است که امکان تعامل با سایر برنامه‌ها و دستگاه‌ها را فراهم می‌کند.

- **`parseVCF(vcfContent: string)`**:
  - این تابع یک رشته با محتوای فایل `.vcf` را به عنوان ورودی می‌گیرد.
  - خطوط فایل را بر اساس استاندارد vCard (مانند `FN`, `TEL`, `EMAIL`, `PHOTO`) پردازش می‌کند.
  - اطلاعات هر vCard را به یک آبجکت `Contact` تبدیل کرده و در نهایت آرایه‌ای از مخاطبین را برمی‌گرداند.
  - این تابع از unfolding خطوط و انکودینگ Base64 برای تصاویر پشتیبانی می‌کند.

- **`generateVCF(contacts: Contact[])`**:
  - این تابع یک آرایه از مخاطبین (`Contact[]`) را دریافت می‌کند.
  - برای هر مخاطب، یک رشته با فرمت vCard استاندارد تولید می‌کند.
  - در نهایت، یک رشته واحد شامل تمام vCard ها را برمی‌گرداند که می‌توان آن را به عنوان یک فایل `.vcf` ذخیره کرد.

## جریان کاری کاربر

1.  **نمایش لیست**: مخاطبین به صورت پیش‌فرض بر اساس حروف الفبا مرتب شده و گروه‌بندی می‌شوند.
2.  **افزودن مخاطب**: با کلیک بر دکمه "افزودن"، مودال در حالت ویرایش باز می‌شود تا کاربر اطلاعات مخاطب جدید را وارد کند.
3.  **مشاهده/ویرایش**: با کلیک بر روی هر مخاطب، مودال در حالت "مشاهده" باز می‌شود و جزئیات کامل او را نمایش می‌دهد. در این حالت، دکمه "ویرایش" وجود دارد که مودال را به حالت "ویرایش" تغییر می‌دهد.
4.  **جستجو**: نوار جستجو به کاربر اجازه می‌دهد تا به سرعت در میان نام‌ها، شماره‌ها، ایمیل‌ها و شرکت‌ها جستجو کند.
5.  **وارد کردن (Import)**: کاربر با کلیک بر روی دکمه "وارد کردن" و انتخاب یک یا چند فایل `.vcf`، می‌تواند مخاطبین جدید را به لیست خود اضافه کند.
6.  **خروجی (Export)**: با کلیک بر روی دکمه "خروجی"، تمام مخاطبین در قالب یک فایل `contacts.vcf` برای دانلود آماده می‌شوند.
